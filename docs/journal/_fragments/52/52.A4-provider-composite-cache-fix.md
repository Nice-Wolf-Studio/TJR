# 52.A4 - Provider Composite Cache Fix

**Status**: Complete
**Date**: 2025-10-01

## Problem

The provider-composite package had incorrect cache API usage causing TypeScript build errors:

1. Calling `cache.get(symbol, timeframe)` but CacheStore.get() requires a CacheKey object
2. Expecting arrays back but CacheStore returns single `CachedBar | null`
3. Typo: `CacheBar` instead of `CachedBar`
4. Using wrong number of arguments for cache methods

**Build Errors**:

```
src/index.ts(44,49): error TS2554: Expected 1 arguments, but got 2.
src/index.ts(45,26): error TS2339: Property 'length' does not exist on type 'CachedBar'.
src/index.ts(45,57): error TS2339: Property 'slice' does not exist on type 'CachedBar'.
src/index.ts(47,45): error TS2554: Expected 2 arguments, but got 3.
src/index.ts(47,54): error TS2552: Cannot find name 'CacheBar'. Did you mean 'CachedBar'?
```

## Solution (Wolf Ethos - Simplest Fix)

Removed the cache logic entirely because:

- CacheStore is designed for single-bar caching (by timestamp), not multi-bar range caching
- CompositeProvider coordinates other providers; caching should happen at individual provider level
- The cache code was placeholder/incorrect implementation

**Changes to `/packages/provider-composite/src/index.ts`**:

1. Removed `CacheStore` and `CachedBar` imports
2. Removed `ttlMs` option from `CompositeOptions`
3. Removed `cache` instance from `CompositeProvider`
4. Simplified `getBars()` to directly call `dbGetRecentBars()` in live mode

**Before**:

```typescript
const cached = await this.cache.get(symbol, timeframe);
if (cached && cached.length >= count) return cached.slice(-count);
const fresh = await dbGetRecentBars(symbol, timeframe, count);
await this.cache.set(symbol, timeframe, fresh as CacheBar[]);
return fresh;
```

**After**:

```typescript
return dbGetRecentBars(symbol, timeframe, count);
```

## Verification

```bash
cd packages/provider-composite && pnpm build
```

Build passes with no errors.

## Notes

- If multi-bar caching is needed later, use `MarketDataCacheService` from bars-cache
- Individual providers (databento) should handle their own caching strategy
- CompositeProvider remains a thin coordination layer
