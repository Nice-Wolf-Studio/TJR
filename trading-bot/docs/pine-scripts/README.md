# TradingView Pine Script Templates

This directory contains comprehensive Pine Script templates for generating webhook alerts that integrate with the TJR Trading Bot system.

## Overview

These Pine Scripts are designed to detect various market conditions and send structured webhook alerts to the trading bot for analysis and alert generation. Each script focuses on specific ICT (Inner Circle Trading) concepts and market structure analysis.

## Available Scripts

### 1. Confluence Detector (`confluence-detector.pine`)

Detects high-confluence zones by combining multiple market factors:

**Features:**
- Liquidity level detection and strength analysis
- Market structure analysis (BOS, CHOCH)
- Fair Value Gap (FVG) detection
- Session-based analysis
- Multi-factor confluence scoring
- Configurable alert thresholds

**Webhook Payload Fields:**
```json
{
  "type": "confluence",
  "confluence_score": 8.5,
  "confluence_factors": "Liquidity_5,Structure_High,FVG,Session_London",
  "structure_break": true,
  "bos_type": "bullish",
  "fvg_detected": true,
  "session": "London",
  "confidence": 0.85
}
```

### 2. Liquidity Sweep Detector (`liquidity-sweep-detector.pine`)

Specialized in detecting liquidity sweeps and session extreme breaks:

**Features:**
- Session high/low tracking (Asia, London, New York)
- Equal highs/lows detection
- Liquidity sweep confirmation with retest requirements
- Session overlap analysis
- Sweep strength calculation

**Webhook Payload Fields:**
```json
{
  "type": "liquidity_sweep",
  "direction": "bullish",
  "swept_price": 1.0950,
  "sweep_strength": 3.2,
  "level_info": "high_London_4touches",
  "session": "NewYork",
  "session_high": 1.0955,
  "session_low": 1.0920
}
```

### 3. Session Alerts (`session-alerts.pine`)

Comprehensive session-based analysis and alerts:

**Features:**
- Session transition detection
- Session breakout identification
- London-NY overlap tracking
- ICT concept integration (SMT, Liquidity Runs, Turtle Soup)
- Session performance analysis

**Webhook Payload Fields:**
```json
{
  "type": "session_start",
  "session": "London",
  "session_high": 1.0945,
  "session_low": 1.0912,
  "session_range": 0.33,
  "breakout_direction": "bullish"
}
```

### 4. Structure & BOS Detector (`structure-bos-detector.pine`)

Advanced market structure and Break of Structure detection:

**Features:**
- Market structure analysis with trend detection
- BOS (Break of Structure) identification
- CHOCH (Change of Character) detection
- MSS (Market Structure Shift) analysis
- Internal structure tracking

**Webhook Payload Fields:**
```json
{
  "type": "bos",
  "direction": "bullish",
  "bos_level": 1.0940,
  "bos_strength": 1.8,
  "bos_type": "choch",
  "current_trend": "bearish",
  "structure_break": true
}
```

### 5. FVG Detector (`fvg-detector.pine`)

Fair Value Gap detection with ICT concepts:

**Features:**
- Regular FVG detection (bullish/bearish)
- SIBI (Sell Side Imbalance) detection
- BISI (Buy Side Imbalance) detection
- Breaker block identification
- FVG fill tracking and invalidation

**Webhook Payload Fields:**
```json
{
  "type": "fvg_formation",
  "fvg_type": "bullish",
  "fvg_top": 1.0945,
  "fvg_bottom": 1.0932,
  "fvg_size_pct": 0.0012,
  "fvg_classification": "breaker",
  "fvg_strength": 4.2
}
```

## Setup Instructions

### 1. TradingView Configuration

1. Copy the desired Pine Script template to TradingView
2. Configure the input parameters according to your trading preferences
3. Set up webhook alerts with the bot's webhook URL

### 2. Webhook URL Configuration

The webhook URL format for alerts:
```
https://your-domain.com/webhook/tradingview
```

For local development:
```
http://localhost:3001/webhook/tradingview
```

### 3. Alert Configuration in TradingView

1. **Alert Conditions**: Set alerts on the script's alert conditions
2. **Alert Frequency**: Use "Once Per Bar" or "Once Per Bar Close"
3. **Webhook URL**: Enter your webhook endpoint URL
4. **Message**: Use the default message generated by the script

## Environment Variables

Configure these environment variables for webhook integration:

```bash
# Webhook Basic Configuration
TRADINGVIEW_WEBHOOK_ENABLED=true
TRADINGVIEW_WEBHOOK_PORT=3001
TRADINGVIEW_WEBHOOK_PATH=/webhook/tradingview
TRADINGVIEW_WEBHOOK_SECRET=your_webhook_secret

# Security Settings
TRADINGVIEW_WEBHOOK_SIGNATURE_VALIDATION=true
TRADINGVIEW_WEBHOOK_RATE_LIMIT=true
TRADINGVIEW_WEBHOOK_DDOS_PROTECTION=true

# Rate Limiting
TRADINGVIEW_WEBHOOK_MAX_ALERTS_PER_MIN=100
TRADINGVIEW_WEBHOOK_MAX_ALERTS_PER_HOUR=1000

# Signal Processing
TRADINGVIEW_WEBHOOK_MIN_CONFIDENCE=0.6
TRADINGVIEW_WEBHOOK_MIN_CONFLUENCE_SCORE=5.0
TRADINGVIEW_WEBHOOK_ALLOWED_TIMEFRAMES=1m,5m,15m,1h,4h,1d

# Integration Settings
TRADINGVIEW_WEBHOOK_ANALYSIS_INTEGRATION=true
TRADINGVIEW_WEBHOOK_ALERT_GENERATION=true
```

## Pine Script Customization

### Input Parameters

Each script provides comprehensive input parameters for customization:

- **Detection Sensitivity**: Adjust thresholds for different market conditions
- **Timeframe Settings**: Configure lookback periods and confirmation requirements
- **Visual Settings**: Control display of levels, signals, and information tables
- **Alert Settings**: Enable/disable specific alert types and set frequency

### Alert Message Customization

The webhook payloads are automatically generated with structured JSON data. You can modify the payload generation functions in each script to include additional fields or customize the data format.

### Performance Optimization

For high-frequency alerts:
1. Increase rate limiting settings
2. Enable deduplication
3. Use appropriate timeframe filters
4. Set minimum confidence thresholds

## Integration with Trading Bot

The webhook alerts integrate seamlessly with the trading bot's analysis system:

1. **Signal Processing**: Incoming alerts are processed and validated
2. **Analysis Engine Integration**: Signals trigger analysis engine updates
3. **Alert Generation**: High-quality signals generate Discord alerts
4. **Performance Tracking**: Signal outcomes are tracked for optimization

## Troubleshooting

### Common Issues

1. **Webhook Not Receiving Alerts**
   - Check webhook URL format and accessibility
   - Verify TradingView alert configuration
   - Confirm webhook service is running

2. **High Alert Volume**
   - Adjust sensitivity parameters
   - Enable deduplication
   - Increase confidence thresholds

3. **Signal Quality Issues**
   - Review confluence scoring parameters
   - Adjust minimum strength requirements
   - Check timeframe compatibility

### Debugging

Enable debug logging to troubleshoot webhook issues:

```bash
LOG_LEVEL=debug
TRADINGVIEW_WEBHOOK_ENABLE_DEDUPLICATION=true
```

## Best Practices

### Alert Configuration

1. **Start Conservative**: Begin with higher thresholds and adjust based on performance
2. **Test Thoroughly**: Use paper trading or backtesting before live deployment
3. **Monitor Performance**: Track signal quality and adjust parameters accordingly

### Pine Script Optimization

1. **Resource Management**: Limit historical lookback periods for performance
2. **Visual Elements**: Disable unnecessary visual elements in production
3. **Alert Frequency**: Use appropriate alert frequency to avoid spam

### Security

1. **Webhook Secrets**: Always use webhook secrets for signature validation
2. **Rate Limiting**: Configure appropriate rate limits for your needs
3. **IP Whitelisting**: Consider IP restrictions for additional security

## Support and Updates

These Pine Scripts are actively maintained and updated with:
- Bug fixes and performance improvements
- New ICT concepts and detection methods
- Enhanced webhook payload structures
- Improved visual indicators and tables

For questions or custom requirements, refer to the main trading bot documentation or contact the development team.